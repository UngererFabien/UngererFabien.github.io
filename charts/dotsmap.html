  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./styles/styles.css">

    <script type="text/javascript" src="./js/libs/underscore.js"></script>

    <script type="text/javascript" src="./js/libs/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="./js/libs/underscore.js"></script>
    <script type="text/javascript" src="./js/libs/d3/d3.js"></script>
    <script type="text/javascript" src="./js/libs/d3/d3.chart.js"></script>
    <script type="text/javascript" src="./js/libs/d3/topojson.js"></script>
    <script type="text/javascript" src="./js/libs/solar.js"></script>

    <script type="text/javascript" src="./js/DotsMap.js"></script>
  </head>
  <body>
    <div class="chart map"></div>

    <script type="text/javascript">

      var cities = [{"lon":20.46513,"lat":44.80401},{"lon":14.50513,"lat":46.05108},{"lon":15.64007,"lat":78.2186},{"lon":103.85007,"lat":1.28967},{"lon":-5.71675,"lat":-15.93872},{"lon":18.0649,"lat":59.33258},{"lon":-61.85,"lat":17.11667},{"lon":-63.05783,"lat":18.21704},{"lon":13.23432,"lat":-8.83682},{"lon":19.81889,"lat":41.3275},{"lon":44.51361,"lat":40.18111},{"lon":1.52109,"lat":42.50779},{"lon":54.36667,"lat":24.46667},{"lon":69.17233,"lat":34.52813},{"lon":-170.7025,"lat":-14.27806},{"lon":16.37208,"lat":48.20849},{"lon":-58.37723,"lat":-34.61315},{"lon":-59.61667,"lat":13.1},{"lon":90.40744,"lat":23.7104},{"lon":149.12807,"lat":-35.28346},{"lon":-70.02703,"lat":12.52398},{"lon":19.93481,"lat":60.09726},{"lon":49.89201,"lat":40.37767},{"lon":18.35644,"lat":43.84864},{"lon":50.5832,"lat":26.21536},{"lon":29.3644,"lat":-3.3822},{"lon":2.60359,"lat":6.49646},{"lon":-62.84978,"lat":17.89618},{"lon":-64.77797,"lat":32.29149},{"lon":114.94806,"lat":4.94029},{"lon":-65.26274,"lat":-19.03332},{"lon":-47.92972,"lat":-15.77972},{"lon":-75.69812,"lat":45.41117},{"lon":-77.34306,"lat":25.05823},{"lon":89.64191,"lat":27.46609},{"lon":25.90859,"lat":-24.65451},{"lon":4.34878,"lat":50.85045},{"lon":27.56667,"lat":53.9},{"lon":-1.53388,"lat":12.36566},{"lon":-88.76667,"lat":17.25},{"lon":23.32415,"lat":42.69751},{"lon":-5.27674,"lat":6.82055},{"lon":-159.775,"lat":-21.20778},{"lon":-70.64827,"lat":-33.45694},{"lon":11.51667,"lat":3.86667},{"lon":96.82251,"lat":-12.15681},{"lon":15.30807,"lat":-4.32142},{"lon":18.55496,"lat":4.36122},{"lon":15.28318,"lat":-4.26613},{"lon":7.44744,"lat":46.94809},{"lon":116.39723,"lat":39.9075},{"lon":33.36667,"lat":35.16667},{"lon":-74.08175,"lat":4.60971},{"lon":-84.08333,"lat":9.93333},{"lon":14.42076,"lat":50.08804},{"lon":-82.38304,"lat":23.13302},{"lon":-23.51254,"lat":14.93152},{"lon":-68.93354,"lat":12.1084},{"lon":105.67912,"lat":-10.42172},{"lon":13.41053,"lat":52.52437},{"lon":3.04197,"lat":36.7525},{"lon":-78.52495,"lat":-0.22985},{"lon":43.14503,"lat":11.58901},{"lon":12.56553,"lat":55.67594},{"lon":-61.38808,"lat":15.30174},{"lon":-69.98857,"lat":18.50012},{"lon":24.75353,"lat":59.43696},{"lon":31.24967,"lat":30.06263},{"lon":-13.20315,"lat":27.16224},{"lon":38.93184,"lat":15.33805},{"lon":-3.70256,"lat":40.4165},{"lon":2.3488,"lat":48.85341},{"lon":38.74689,"lat":9.02497},{"lon":24.93545,"lat":60.16952},{"lon":178.44149,"lat":-18.14161},{"lon":-57.85,"lat":-51.7},{"lon":158.16109,"lat":6.92477},{"lon":-6.77164,"lat":62.00973},{"lon":9.45356,"lat":0.39241},{"lon":-0.12574,"lat":51.50853},{"lon":-90.51327,"lat":14.64072},{"lon":144.74886,"lat":13.47567},{"lon":-15.59767,"lat":11.86357},{"lon":-58.15527,"lat":6.80448},{"lon":114.15769,"lat":22.28552},{"lon":23.71622,"lat":37.97945},{"lon":-87.20681,"lat":14.0818},{"lon":-61.74849,"lat":12.05644},{"lon":44.83368,"lat":41.69411},{"lon":-52.33333,"lat":4.93333},{"lon":-2.53527,"lat":49.45981},{"lon":-0.1969,"lat":5.55602},{"lon":-5.35257,"lat":36.14474},{"lon":-51.72157,"lat":64.18347},{"lon":-16.57803,"lat":13.45274},{"lon":-13.67729,"lat":9.53795},{"lon":-61.72548,"lat":15.99854},{"lon":8.78333,"lat":3.75},{"lon":-36.5092,"lat":-54.28111},{"lon":106.84513,"lat":-6.21462},{"lon":15.97798,"lat":45.81444},{"lon":19.03991,"lat":47.49801},{"lon":-72.335,"lat":18.53917},{"lon":77.22445,"lat":28.63576},{"lon":-6.24889,"lat":53.33306},{"lon":-4.48333,"lat":54.15},{"lon":12.4839,"lat":41.89474},{"lon":44.40088,"lat":33.34058},{"lon":51.42151,"lat":35.69439},{"lon":-21.89541,"lat":64.13548},{"lon":28.8575,"lat":47.00556},{"lon":19.26361,"lat":42.44111},{"lon":-63.08333,"lat":18.06667},{"lon":47.53613,"lat":-18.91368},{"lon":171.38027,"lat":7.08971},{"lon":71.44598,"lat":51.1801},{"lon":21.42878,"lat":42.00122},{"lon":102.6,"lat":17.96667},{"lon":35.49442,"lat":33.88894},{"lon":-61.00614,"lat":13.9957},{"lon":9.52154,"lat":47.14151},{"lon":-8,"lat":12.65},{"lon":79.84778,"lat":6.93194},{"lon":-10.7969,"lat":6.30054},{"lon":27.48333,"lat":-29.31667},{"lon":36.81667,"lat":-1.28333},{"lon":25.2798,"lat":54.68916},{"lon":6.13,"lat":49.61167},{"lon":74.59,"lat":42.87},{"lon":104.91601,"lat":11.56245},{"lon":-2.10491,"lat":49.18804},{"lon":172.97696,"lat":1.3278},{"lon":43.25506,"lat":-11.70216},{"lon":24.10589,"lat":56.946},{"lon":-76.79358,"lat":17.99702},{"lon":-62.7261,"lat":17.29484},{"lon":13.18746,"lat":32.87519},{"lon":35.94503,"lat":31.95522},{"lon":125.75432,"lat":39.03385},{"lon":126.97783,"lat":37.56826},{"lon":-6.83255,"lat":34.01325},{"lon":139.69171,"lat":35.6895},{"lon":47.97833,"lat":29.36972},{"lon":-81.36706,"lat":19.28692},{"lon":7.41667,"lat":43.73333},{"lon":167.96628,"lat":-29.05459},{"lon":101.68653,"lat":3.1412},{"lon":32.58322,"lat":-25.96553},{"lon":17.08323,"lat":-22.55941},{"lon":4.88969,"lat":52.37403},{"lon":166.4572,"lat":-22.27631},{"lon":2.1098,"lat":13.51366},{"lon":96.12972,"lat":19.745},{"lon":7.48375,"lat":9.06853},{"lon":106.88324,"lat":47.90771},{"lon":-86.2504,"lat":12.13282},{"lon":113.54611,"lat":22.20056},{"lon":145.7545,"lat":15.21233},{"lon":-61.07334,"lat":14.60892},{"lon":-15.9785,"lat":18.08581},{"lon":-62.21292,"lat":16.70555},{"lon":14.51472,"lat":35.89972},{"lon":57.49889,"lat":-20.16194},{"lon":-99.12766,"lat":19.42847},{"lon":73.50888,"lat":4.1748},{"lon":33.78725,"lat":-13.96692},{"lon":58.5922,"lat":23.61387},{"lon":-79.51973,"lat":8.9936},{"lon":-77.02824,"lat":-12.04318},{"lon":10.74609,"lat":59.91273},{"lon":-149.56667,"lat":-17.53333},{"lon":147.17972,"lat":-9.44314},{"lon":85.3206,"lat":27.70169},{"lon":-169.91867,"lat":-19.05952},{"lon":174.77557,"lat":-41.28664},{"lon":120.9822,"lat":14.6042},{"lon":-56.17196,"lat":46.78091},{"lon":-130.10147,"lat":-25.06597},{"lon":73.04329,"lat":33.72148},{"lon":21.01178,"lat":52.22977},{"lon":-77.03637,"lat":38.89511},{"lon":32.58219,"lat":0.31628},{"lon":30.05885,"lat":-1.94995},{"lon":46.72185,"lat":24.68773},{"lon":159.95,"lat":-9.43333},{"lon":55.45,"lat":-4.61667},{"lon":32.53241,"lat":15.55177},{"lon":37.61556,"lat":55.75222},{"lon":26.10626,"lat":44.43225},{"lon":134.62355,"lat":7.50043},{"lon":-66.10572,"lat":18.46633},{"lon":-57.63591,"lat":-25.30066},{"lon":51.52245,"lat":25.27932},{"lon":55.4504,"lat":-20.88231},{"lon":-9.13333,"lat":38.71667},{"lon":70.21667,"lat":-49.35},{"lon":1.21227,"lat":6.13748},{"lon":68.77905,"lat":38.53575},{"lon":125.57361,"lat":-8.55861},{"lon":58.38333,"lat":37.95},{"lon":10.16579,"lat":36.81897},{"lon":30.5238,"lat":50.45466},{"lon":-175.2,"lat":-21.13333},{"lon":-61.51657,"lat":10.66617},{"lon":179.19417,"lat":-8.52425},{"lon":121.53185,"lat":25.04776},{"lon":17.10674,"lat":48.14816},{"lon":-13.22994,"lat":8.484},{"lon":35.73947,"lat":-6.17221},{"lon":12.44639,"lat":43.93667},{"lon":100.50144,"lat":13.75398},{"lon":-17.44406,"lat":14.6937},{"lon":45.34375,"lat":2.03711},{"lon":-55.16682,"lat":5.86638},{"lon":31.58247,"lat":4.85165},{"lon":6.72732,"lat":0.33654},{"lon":-89.18718,"lat":13.68935},{"lon":-63.04582,"lat":18.026},{"lon":32.85427,"lat":39.91987},{"lon":36.29128,"lat":33.5102},{"lon":31.13333,"lat":-26.31667},{"lon":-71.14188,"lat":21.46122},{"lon":15.0444,"lat":12.10672},{"lon":-56.16735,"lat":-34.83346},{"lon":-64.61667,"lat":18.41667},{"lon":-64.9307,"lat":18.3419},{"lon":105.84117,"lat":21.0245},{"lon":168.32188,"lat":-17.73381},{"lon":-176.17453,"lat":-13.28163},{"lon":-171.76666,"lat":-13.83333},{"lon":21.16688,"lat":42.67272},{"lon":45.22722,"lat":-12.77944},{"lon":44.20667,"lat":15.35472},{"lon":28.18783,"lat":-25.74486},{"lon":69.21627,"lat":41.26465},{"lon":12.45332,"lat":41.90236},{"lon":-61.22475,"lat":13.15872},{"lon":28.28713,"lat":-15.40669},{"lon":31.05337,"lat":-17.82772},{"lon":-66.87919,"lat":10.48801}];

      function getRandomCity () {
        return cities[Math.round(Math.random()*239)];
      }

      var t = 0;

      function rData () {
        var points = [];

        for(var i = 0; i < 100; i++) {
          var point = getRandomCity(); point.id = t++;
          points.push(point);
        }

        return points;
      }

      function updateRandomData (points) {
        points.splice(0, 10);

        for(var i = 0; i < 10; i++) {
          var point = getRandomCity(); point.id = t++;
          points.push(point);
        }

        return points;
      }

      var chart = d3.select('.chart')
        .chart('SolarTerminatorChart');

      var randomData = rData();
      // console.log(randomData);
      chart.draw(randomData);

      setInterval(function () {
        updateRandomData(randomData);
        chart.draw(randomData)
      }, 1000)

    </script>
  </body>
  </html>